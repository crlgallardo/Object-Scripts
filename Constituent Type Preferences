SELECT [id]
      ,[name]
      ,[donor_category]
      ,[donor_category_desc]
      ,[alum_ind]
  FROM [Datamart].[dbo].[Donor Category (Descriptive, Advancement)];
  
  
  CREATE VIEW roundCorner_Constituent_Types as
  SELECT  ID + '_' + donor_category AS External_ID,
		 (CASE WHEN donor_category = 'CORP' THEN 'ORG' + ID ELSE NULL END) AS rc_Bios__Account__c,
		 (CASE WHEN donor_category <> 'CORP' THEN ID ELSE NULL END)AS rc_Bios__Contact__c, 
		  DONOR_CATEGORY as rc_Bios__Code_Value__c,
		 (SELECT 'TRUE' 
		  FROM [All Constituents (Domain, Advancement)] A 
		  WHERE A.ID = B.ID AND A.PREF_DONOR_CATEGORY = B.DONOR_CATEGORY) AS PRIMARY_CONSTITUENT_TYPE, 		 
		 (CASE WHEN donor_category IN ('FACF', 'GRPF', 'PARF', 'STFF', 'TRSF') THEN 'FALSE' ELSE 'TRUE' END) AS rc_Bios__Active__c
  FROM [Donor Category (Descriptive, Advancement)] B
  ORDER BY ID DESC;
  
  SELECT * FROM roundCorner_Constituent_Types
  
  SELECT *
  FROM [All Constituents (Domain, Advancement)]
  --WHERE ID IN ('R00000025', 'R01887400', 'R01887401', 'R0188740')
  ORDER BY ID ASC;
  
  SELECT DISTINCT A.ID, B.ID, A.name, A.DONOR_CATEGORY, A.DONOR_CATEGORY_DESC, COUNT(*)
  FROM [Donor Category (Descriptive, Advancement)] A, [All Constituents (Domain, Advancement)] B 
  --WHERE donor_category = 'GVMT'
  WHERE A.id = B.ID --AND B.ID IN ('R00000025', 'R01887400', 'R01887401')
  GROUP BY A.ID, B.ID, A.name, A.DONOR_CATEGORY, A.DONOR_CATEGORY_DESC
  --HAVING COUNT(*)>1;
  
  /* Constituent Type Preferences View from All Constituents View and Donor Category Table */
  SELECT DISTINCT A.ID, 
				  B.ID, 
				  A.NAME, 
				  --B.PREF_DONOR_CATEGORY, 
				  --B.PREF_DONOR_CATEGORY_DESC, 
				  A.DONOR_CATEGORY, 
				  A.DONOR_CATEGORY_DESC, 
				  COUNT(*)
  FROM [Donor Category (Descriptive, Advancement)] A, [All Constituents (Domain, Advancement)] B 
  --WHERE donor_category = 'GVMT'
  WHERE A.id = B.ID /*AND B.PREF_DONOR_CATEGORY = A.DONOR_CATEGORY*/ --AND B.ID IN ('R00000025', 'R01887400', 'R01887401', 'R00000039', 'R00000034')
  GROUP BY A.ID, 
		   B.ID, 
		   A.NAME, 
		   B.PREF_DONOR_CATEGORY, 
		   B.PREF_DONOR_CATEGORY_DESC,
		   A.DONOR_CATEGORY, 
		   A.DONOR_CATEGORY_DESC
  ORDER BY A.id ASC;
		   
  

 /* This script identifies the Donor Categories with IDs that are not in All Constituents View */ 
  SELECT DISTINCT A.ID, COUNT(*)
  FROM [Donor Category (Descriptive, Advancement)] A
  WHERE A.id NOT IN (SELECT B.ID 
  FROM [All Constituents (Domain, Advancement)] B)
  GROUP BY A.ID
  HAVING COUNT(*)>= 1;
  
  SELECT DISTINCT A.ID, B.ID, COUNT(*)
  FROM [Donor Category (Descriptive, Advancement)] A
  LEFT JOIN [All Constituents (Domain, Advancement)] B
  ON A.id = B.ID --AND B.ID IN ('R00000034')
  GROUP BY A.ID, B.ID;
